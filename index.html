<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Neutrino</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #111;
      color: white;
      margin: 0;
      padding: 0;
    }

    #toolbar {
      display: flex;
      gap: 5px;
      padding: 8px;
      background-color: #222;
      align-items: center;
      position: relative;
      z-index: 2;
    }

    #title {
      font-size: 20px;
      margin-right: 10px;
    }

    #url {
      flex: 1;
      padding: 6px;
      background: #333;
      color: white;
      border: none;
      outline: none;
    }

    #toolbar button {
      background: #444;
      color: white;
      border: none;
      padding: 6px 10px;
      cursor: pointer;
    }

    #toolbar button:hover {
      background: #555;
    }

    #tabs {
      display: flex;
      background-color: #333;
      padding: 5px;
      overflow-x: auto;
    }

    .tab {
      background-color: #444;
      padding: 6px 10px;
      margin-right: 5px;
      cursor: pointer;
      border-radius: 4px;
      display: flex;
      align-items: center;
    }

    .tab.active {
      background-color: #555;
    }

    .tab span {
      margin-right: 8px;
    }

    .close-tab {
      background: none;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    #browser-container {
      height: calc(100vh - 100px);
    }

    webview {
      width: 100%;
      height: 100%;
      border: none;
    }

    #history-dropdown {
      position: absolute;
      top: 52px;
      right: 10px;
      background-color: #222;
      border: 1px solid #444;
      max-height: 300px;
      overflow-y: auto;
      display: none;
      z-index: 5;
    }

    .history-item {
      padding: 8px;
      cursor: pointer;
      border-bottom: 1px solid #333;
    }

    .history-item:hover {
      background-color: #333;
    }

    .clear-history {
      text-align: center;
      padding: 6px;
      background-color: #333;
      cursor: pointer;
      font-weight: bold;
    }

    .clear-history:hover {
      background-color: #444;
    }
  </style>
</head>
<body>

  <div id="toolbar">
    <span id="title">Neutrino</span>
    <button onclick="goBack()">←</button>
    <button onclick="goForward()">→</button>
    <button onclick="reload()">⟳</button>
    <button onclick="goHome()">Home</button>
    <input id="url" placeholder="Enter URL" oninput="updateURL()" onkeydown="handleEnter(event)" />
    <button onclick="loadURL()">Go</button>
    <button onclick="toggleHistory()">History</button>
  </div>

  <div id="tabs"></div>
  <div id="browser-container"></div>
  <div id="history-dropdown"></div>

  <script>
    let tabs = [];
    let activeTabIndex = -1;
    let history = JSON.parse(localStorage.getItem("browsingHistory") || "[]");

    function createWebview(src = "https://www.google.com") {
      const webview = document.createElement("webview");
      webview.src = src;
      webview.setAttribute("partition", `persist:tab${Date.now()}`);
      webview.addEventListener("did-finish-load", () => {
        const title = webview.getTitle() || "New Tab";
        tabs[activeTabIndex].title = title;
        renderTabs();
      });
      return webview;
    }

    function newTab() {
      const webview = createWebview();
      tabs.push({ webview, title: "New Tab" });
      activeTabIndex = tabs.length - 1;
      renderTabs();
      renderWebview();
    }

    function closeTab(index) {
      tabs.splice(index, 1);
      if (activeTabIndex >= tabs.length) activeTabIndex = tabs.length - 1;
      renderTabs();
      renderWebview();
    }

    function switchTab(index) {
      activeTabIndex = index;
      renderTabs();
      renderWebview();
    }

    function renderTabs() {
      const tabsContainer = document.getElementById("tabs");
      tabsContainer.innerHTML = '';
      tabs.forEach((tab, index) => {
        const tabElement = document.createElement("div");
        tabElement.className = "tab" + (index === activeTabIndex ? " active" : "");
        tabElement.onclick = () => switchTab(index);

        const titleSpan = document.createElement("span");
        titleSpan.textContent = tab.title || "New Tab";

        const closeBtn = document.createElement("button");
        closeBtn.textContent = "×";
        closeBtn.className = "close-tab";
        closeBtn.onclick = (e) => {
          e.stopPropagation();
          closeTab(index);
        };

        tabElement.appendChild(titleSpan);
        tabElement.appendChild(closeBtn);
        tabsContainer.appendChild(tabElement);
      });
    }

    function renderWebview() {
      const container = document.getElementById("browser-container");
      container.innerHTML = '';
      if (tabs[activeTabIndex]) {
        container.appendChild(tabs[activeTabIndex].webview);
      }
    }

    function updateURL() {
      const urlInput = document.getElementById("url");
      urlInput.value = tabs[activeTabIndex]?.webview.src || "https://www.google.com";
    }

    function loadURL() {
      let url = document.getElementById("url").value.trim();

      if (!url.includes('.')) {
        url = `https://www.google.com/search?q=${encodeURIComponent(url)}`;
      } else if (!url.startsWith("http")) {
        url = "https://" + url;
      }

      tabs[activeTabIndex].webview.src = url;
      saveToHistory(url);
    }

    function handleEnter(e) {
      if (e.key === "Enter") loadURL();
    }

    function goBack() {
      const webview = tabs[activeTabIndex]?.webview;
      if (webview && webview.canGoBack()) webview.goBack();
    }

    function goForward() {
      const webview = tabs[activeTabIndex]?.webview;
      if (webview && webview.canGoForward()) webview.goForward();
    }

    function reload() {
      const webview = tabs[activeTabIndex]?.webview;
      if (webview) webview.reload();
    }

    function goHome() {
      const webview = tabs[activeTabIndex]?.webview;
      if (webview) webview.src = "https://www.google.com";
    }

    function saveToHistory(url) {
      if (!history.includes(url)) {
        history.unshift(url);
        if (history.length > 50) history.pop();
        localStorage.setItem("browsingHistory", JSON.stringify(history));
      }
    }

    function toggleHistory() {
      const historyDropdown = document.getElementById("history-dropdown");
      if (historyDropdown.style.display === "block") {
        historyDropdown.style.display = "none";
      } else {
        renderHistory();
        historyDropdown.style.display = "block";
      }
    }

    function renderHistory() {
      const historyDropdown = document.getElementById("history-dropdown");
      historyDropdown.innerHTML = '';
      history.forEach(url => {
        const item = document.createElement('div');
        item.className = 'history-item';
        item.textContent = url;
        item.onclick = () => {
          tabs[activeTabIndex].webview.src = url;
          document.getElementById("url").value = url;
          historyDropdown.style.display = 'none';
        };
        historyDropdown.appendChild(item);
      });

      const clear = document.createElement('div');
      clear.className = 'clear-history';
      clear.textContent = "Clear History";
      clear.onclick = () => {
        history = [];
        localStorage.removeItem("browsingHistory");
        renderHistory();
      };
      historyDropdown.appendChild(clear);
    }

    newTab();
  </script>

</body>
</html>
